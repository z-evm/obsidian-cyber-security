**Malware persistence** refers to the techniques malware uses to **remain active on a system across reboots, logouts, or session terminations**. Persistence allows attackers to maintain long-term access to compromised systems and is a common component of **Advanced Persistent Threats (APTs)** and **stealthy malware campaigns**.

---

## üéØ Goals of Malware Persistence

- Survive **system reboots**, **logoff events**, and **patches**
- Maintain **covert access** and **control**
- Evade **detection** and resist **removal**
- Enable **automated execution** and **payload reactivation**

> Persistence transforms a one-time execution into an ongoing compromise.

---

## üß± Common Persistence Techniques

### ü™ü Windows-Based Persistence

| Method                  | Description                                         |
|-------------------------|-----------------------------------------------------|
| **Registry Run Keys**   | Auto-start via `HKCU/HKLM\...\Run`                  |
| **Scheduled Tasks**     | Create recurring execution triggers (`schtasks`)    |
| **Service Creation**    | Install as a Windows service                        |
| **Startup Folder Drop** | Places executables or shortcuts in Startup dir      |
| **WMI Event Subscription** | Execute payloads based on system events        |
| **DLL Hijacking**       | Exploits DLL load order to run malicious code       |
| **BITS Jobs**           | Uses Background Intelligent Transfer Service        |
| **COM Hijacking**       | Abuse COM object loading paths                     |

### üêß Linux-Based Persistence

| Method                  | Description                                          |
|-------------------------|------------------------------------------------------|
| **Cron Jobs**           | Run malicious script on a schedule                   |
| **rc.local / init.d**   | Legacy startup scripts                               |
| **Systemd Services**    | Custom unit files in `/etc/systemd/system`          |
| **SSH Key Injection**   | Add attacker‚Äôs key to `authorized_keys`             |
| **.bashrc / .profile**  | Launch malware at terminal start                     |
| **LD_PRELOAD Injection**| Load malicious library before standard libraries     |

---

## üì¶ Malware Families & Persistence TTPs

| Malware              | Persistence Method                         |
|----------------------|---------------------------------------------|
| **Emotet**           | Registry Run key + service install          |
| **AgentTesla**       | Startup folder + encoded registry entry     |
| **Cobalt Strike**    | WMI event subscription, service creation    |
| **TrickBot**         | Task Scheduler + signed LOLBins             |
| **RedLine Stealer**  | Startup folder + `HKCU\Software\Microsoft`  |
| **QakBot**           | DLL injection + scheduled task              |

---

## üîç Detection Techniques

| Tool/Method          | What to Look For                            |
|----------------------|---------------------------------------------|
| **Autoruns**         | Unexpected autostart entries                |
| **Sysmon + SIEM**    | Logon events, registry changes              |
| **Regshot**          | Compare registry snapshots                  |
| **EDR**              | Alert on persistence techniques (T1547)     |
| **YARA/IOC Hunting** | Match known malware persistence patterns    |

---

## üõ° Defense & Hardening

- Monitor **autorun locations** and startup scripts
- Disable **unneeded services** and task scheduling features
- Enable **AppLocker / WDAC / SELinux / AppArmor**
- Use **EDR/XDR solutions** with behavioral detection
- Implement **least privilege** and patch vulnerable software
- Periodically scan for:
  - Suspicious tasks or services
  - Registry anomalies
  - Hidden files or persistence indicators

---

## üß† MITRE ATT&CK Techniques

| Technique ID | Description                          |
|--------------|--------------------------------------|
| `T1547`      | Boot or Logon Autostart Execution    |
| `T1053`      | Scheduled Task/Job                   |
| `T1060`      | Registry Run Keys / Startup Folder   |
| `T1546`      | Event Triggered Execution            |
| `T1037`      | Logon Scripts                        |

---

## üìò Example: Registry-Based Persistence (Windows)

```bash
reg add "HKCU\Software\Microsoft\Windows\CurrentVersion\Run" /v "Updater" /t REG_SZ /d "C:\Users\User\AppData\Roaming\malware.exe"
```
This ensures the malware runs every time the user logs in.

## üîó Related Topics

- [[Persistence Techniques]]
- [[Post-Exploitation]]
- [[EDR & Threat Detection]]
- [[SIEM & Log Analysis]]
- [[Malware Analysis]]
- [[MITRE ATT&CK]]

---

## üè∑ Suggested Tags

#malware #persistence #TTPs #post_exploitation #EDR #red_team #mitre_attack #threat_detection

---

## ‚úÖ To Do

- [ ]  Analyze real malware samples for persistence mechanisms
- [ ]  Build YARA rules to detect registry key persistence
- [ ]  Map malware persistence to MITRE TTPs in ATT&CK Navigator
- [ ]  Compare persistence durability across techniques